"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{2910:function(e,t,s){s.d(t,{Z:function(){return f}});var a=s(5893),r=s(7294),n=s(4926),l=s(2490),o=s(5146),i=s(9773),c=s(6485),d=s.n(c),u=s(9599),m=s(4117);s(6606);var p=s(1268);let h={channel:null};new Promise((e,t)=>{p.Z.connection.bind("connected",async()=>{s()}),p.Z.connection.bind("error",e=>{console.log("Pusher subscription failed:",e)});let s=async()=>{h.channel&&h.channel.unsubscribe(),h.channel=p.Z.subscribe("private-chatgoodmorning-bot"),e(h)}});var x=s(8941),f=function(e){let{index:t,message:s,avatarSource:c,sender:p,updateState:f,setConversation:g,referencedMessage:v,onClick:j,userInfo:b}=e,[w,y]=(0,r.useState)(s),[N,k]=(0,r.useState)(!1),[S,C]=(0,r.useState)(!1),[I,P]=(0,r.useState)(!1),T=(0,r.useRef)(null),E=(0,r.useRef)(null);(0,r.useEffect)(()=>{y(s)},[s]),(0,r.useEffect)(()=>{if(!I)return;let e=E.current;e.selectionStart=e.selectionEnd=e.value.length},[I]);let A=i.S.messages.update.useMutation(),M=i.S.users.addStarredMessage.useMutation();new Date().toLocaleString("en-US",{timeZone:"America/New_York",hour:"numeric",minute:"2-digit",hour12:!0});let R=async()=>{let e={...w,starred:!w.starred};A.mutate(e),M.mutate({messageId:e.id}),y(e),f(t,e)},D=e=>{T.current=window.getSelection().getRangeAt(0).startOffset},F=p.username?p.username:s.role;return(0,a.jsx)("div",{className:"w-full box cursor-pointer",onMouseEnter:()=>C("user"==s.role),onMouseLeave:()=>C("user"==s.role&&!1),onClick:j,children:(0,a.jsxs)("div",{className:"message p-4 pt-4 relative ".concat(s.id==(null==v?void 0:v.id)?"active":""),children:[(0,a.jsx)("img",{src:p.avatarSource||c,alt:"Avatar",className:"w-9 h-9 rounded-full absolute left-4 top-2"}),(0,a.jsxs)("div",{className:"pl-16 pt-0",children:[(0,a.jsx)("span",{className:"text-sm mb-1 inline-block name",children:F})," ",(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-xs inline-block absolute top-3 right-4 timestamp",children:[(0,a.jsxs)("span",{className:"message-direction",children:["ChatGPT-3.5"==p?"Received":s.inProgress?"Typing...":"Sent",(0,a.jsx)("i",{className:"fa-regular ".concat("ChatGPT-3.5"==p?"fa-arrow-down-left":"fa-arrow-up-right"," fa-lg ml-1 mr-3 mt-2")})]})," ",function(e){let t=e?new Date(e):new Date,s=(0,u.Z)(t,"America/New_York"),a=(0,m.Z)(s,"h:mm a");return a}(s.createdAt),(0,a.jsx)("i",{className:"fa-stars ".concat(w.starred?"fa-solid":"fa-regular"," ml-2 text-yellow cursor-pointer"),onClick:R}),N?(0,a.jsx)("i",{className:"fa-solid fa-check text-green w-5 h-5 ml-3"}):(0,a.jsx)("i",{className:"fa-light fa-copy w-5 h-5 ml-3 cursor-pointer",onClick:()=>{!function(e){d()(e).then(()=>{console.log("Copied to clipboard:",e),k(!0),setTimeout(()=>k(!1),2e3)}).catch(e=>console.error("Failed to copy:",e))}(w.content)}}),b.enableChatGMBot&&b.telegramUserId&&(0,a.jsx)("i",{className:"fa fa-telegram text-lightblue w-5 h-5 ml-3",onClick:async e=>{var t;e.stopPropagation();let s=await x.L.openai.queryPrompt.query(w);null===(t=h.channel)||void 0===t||t.trigger("client-message",{message:s,userId:b.telegramUserId})}}),S&&(0,a.jsx)("div",{className:"absolute top-9 right-0 mb-2 mr-0 cursor-pointer",onClick:()=>{P(!0)},children:(0,a.jsx)("i",{className:"fa-sharp fa-regular fa-pen-to-square w-5 h-5 ml-3 cursor-pointer",onClick:()=>{P(!0)}})})]}),I?(0,a.jsxs)("form",{children:[(0,a.jsx)("textarea",{value:w.content,ref:E,className:"p-0 m-0 mt-5 h-auto w-full border-none focus:outline-none",rows:"1",autoFocus:!0,spellCheck:"false",onInput:e=>{y({...w,content:e.target.value})},onBlur:D}),(0,a.jsx)("div",{className:"py-5 flex justify-center",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:" p-0 !important",children:(0,a.jsx)("button",{type:"button",onClick:()=>{console.log("localMessage",w),A.mutate(w),P(!1),f(t,w,!0)},className:"editing-message-save px-6 py-2 text-xs font-semibold uppercase tracking-wide transition-colors duration-200 border rounded border-transparent text-white btn-gray bg-transparent",children:"Save & Submit"})}),(0,a.jsx)("div",{className:"h-4 w-px mx-3"}),(0,a.jsx)("span",{className:"button-container ml-auto",children:(0,a.jsx)("button",{type:"button",onClick:()=>{P(!1),y({...w,content:s.content})},className:"font-semibold text-xs uppercase p-1 editing-message-cancel bg-transparent",children:"Cancel"})})]})})]}):(0,a.jsx)(n.D,{remarkPlugins:[l.Z],rehypePlugins:[o.Z],children:s.content,components:{p:e=>{let{children:t}=e;return(0,a.jsx)(a.Fragment,{children:t&&t.map(e=>{if("string"==typeof e){let t=e.split("\n");return t.map((e,t)=>(0,a.jsxs)(r.Fragment,{children:[t>0&&(0,a.jsx)("br",{}),e]},t))}return e})})}}})]})]})})}},9834:function(e,t,s){s.d(t,{Z:function(){return Y}});var a=s(5893),r=s(7294),n=s(1163),l=s(9773);s(1664);var o=function(e){let{conversation:t,setConversation:s,isActive:o,selectConversation:i,removeConversation:c,updateConversations:d}=e;(0,n.useRouter)();let[u,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)(!1),[x,f]=(0,r.useState)(t.name),g=l.S.conversations.delete.useMutation(),v=l.S.conversations.updateName.useMutation(),j=async e=>{e.stopPropagation();try{let e=await g.mutate(t.id);console.log("delete response:",e),c(t)}catch(e){console.error(e)}},b=async()=>{let e={...t,name:x};s(e),await v.mutate(e),d(e),h(!1)};return(0,a.jsx)("a",{onClick:function(e){if(o)return!1;e.stopPropagation(),m(!0),i(t)},className:"cursor-pointer ".concat(o?"active":""),children:(0,a.jsxs)("li",{className:"p-2 pl-3 whitespace-nowrap overflow-hidden flex items-center justify-between relative",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("i",{className:"fa-solid fa-message-middle text-gray"}),(0,a.jsx)("span",{className:"inline-block",style:{whiteSpace:"nowrap",textOverflow:"clip",overflow:"hidden"},children:p?(0,a.jsx)("form",{className:"p-0 m-0",children:(0,a.jsx)("input",{value:x,className:"border-1 max-h-9 p-0 m-0 h-auto w-full border-none focus:outline-none",rows:"1",autoFocus:!0,spellCheck:"false",onInput:e=>{f(e.target.value)},onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),b())}})}):t.name})]}),o&&(0,a.jsxs)("span",{className:"inline-block ml-2 z-10 absolute right-0 top-1/2 transform -translate-y-1/2",style:{boxShadow:"0 0 0px rgba(54, 59, 66,1)",background:"linear-gradient(90deg, #21262D 100%, transparent)"},children:[p?(0,a.jsx)("i",{className:"fa-solid fa-check mr-2 ml-5 text-gray hover-offwhite",onClick:b}):(0,a.jsx)("i",{className:"fa-sharp fa-solid fa-pen-to-square mr-2 ml-5 text-gray hover-offwhite",onClick:e=>{e.stopPropagation(),h(!0)}}),(0,a.jsx)("i",{className:"fa-solid fa-trash text-gray hover-offwhite mr-2",onClick:j})]}),(0,a.jsx)("div",{className:"absolute hidden top-0 right-0 mt-2 mr-0 flex items-center justify-center w-5 h-5 rounded-full bg-blue-gradient text-white text-xs font-semibold",children:"2"})]})})},i=function(e){let{conversations:t,setConversation:s,activeConversation:l,activeConversationId:i,selectConversation:c,userInfo:d,setUserInfo:u,newConversation:m,setConversations:p,currentRoute:h,c:x}=e,f=(0,n.useRouter)(),[g,v]=(0,r.useState)(t.filter(e=>{var t;return(null===(t=e.participants)||void 0===t?void 0:t.length)<=1}).length>0),[j,b]=(0,r.useState)(t.filter(e=>{var t;return(null===(t=e.participants)||void 0===t?void 0:t.length)>1}).length>0),w=function(e){let t=(0,r.useRef)();return(0,r.useEffect)(()=>{t.current=e}),t.current}(t),y=t.filter(e=>{var t;return(null===(t=e.participants)||void 0===t?void 0:t.length)<=1}),N=t.filter(e=>{var t;return(null===(t=e.participants)||void 0===t?void 0:t.length)>1});function k(e){let s=t.filter(t=>t.id!==e.id);p(s)}function S(e){p([...t.map(t=>t.id===e.id?e:t)])}return(0,r.useEffect)(()=>{console.log("C",x),null==x||x.key},[x]),(0,r.useEffect)(()=>{!g&&(null==w?void 0:w.length)<t.length&&v(y.length>0),!j&&(null==w?void 0:w.length)<t.length&&b(N.length>0)},[t]),(0,a.jsx)("div",{className:"overflow-y-auto",id:"sidebar-top",children:(0,a.jsx)("div",{className:"z-0",children:(0,a.jsx)("ul",{className:"pl-3",children:(0,a.jsxs)("div",{className:"sticky top-0 bg-dark z-20 relative sticky-cover",children:[(0,a.jsxs)("div",{className:"sticky top-2 bg-dark z-20",children:[(0,a.jsxs)("div",{id:"new-chat",className:"border-1 nav-item",children:[(0,a.jsxs)("li",{className:"p-3 mt-1 pl-4 w-4/5 cursor-pointer",onClick:()=>{f.push("/"),m()},children:[(0,a.jsx)("i",{className:"fa-solid fa-arrow-up-right fa-lg"})," New Chat"]}),!d.hideSidebar&&(0,a.jsx)("div",{className:"w-1/4 cursor-default",children:(0,a.jsx)("i",{className:"fa-solid fa-arrow-left cursor-pointer text-gray w-5 h-5 mb-3 ml-3 absolute top-4 right-0 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:e=>u({...d,hideSidebar:!0})})})]}),(0,a.jsx)("a",{href:"#",children:(0,a.jsxs)("li",{className:"p-2 pl-4 mb-3 mt-1",children:[(0,a.jsx)("img",{src:d.avatarSource||"/avatar.png",className:"w-7 h-7 rounded-full"}),(0,a.jsx)("span",{className:"ml-3",children:null==d?void 0:d.username})]})})]}),(0,a.jsxs)("li",{className:"p-2 pl-4 text-offwhite cursor-pointer",onClick:()=>v(!g),children:[(0,a.jsx)("i",{className:"fa-solid text-offwhite ".concat(g?"fa-arrow-down pr-2":"fa-arrow-right pr-2")})," ","Personal"]}),g&&(0,a.jsx)("div",{className:"max-h-[315px] overflow-y-auto",children:(0,a.jsx)("ul",{className:"pl-0",children:y.map((e,t)=>(0,a.jsx)(o,{index:t,selectConversation:()=>{f.push("/conversations/[id]","/conversations/".concat(e.id)),c(e)},conversation:e,isActive:i==e.id,removeConversation:k,setConversation:s,updateConversations:S},t))})}),(0,a.jsxs)("li",{className:"p-2 pl-4 mt-1 text-offwhite cursor-pointer",onClick:()=>b(!j),children:[(0,a.jsx)("i",{className:"fa-solid text-offwhite ".concat(j?"fa-arrow-down pr-2":"fa-arrow-right pr-2")})," ","Group"]}),j&&(0,a.jsx)("div",{className:"max-h-[315px] overflow-y-auto",children:(0,a.jsx)("ul",{className:"pl-0",children:N.map((e,t)=>(0,a.jsx)(o,{index:t,selectConversation:()=>{f.push("/conversations/[id]","/conversations/".concat(e.id)),c(e)},conversation:e,isActive:i==e.id,removeConversation:k,setConversation:s,updateConversations:S},t))})})]})})})})},c=s(3299);function d(e){let{itemText:t,iconName:s,onClick:r,link:n="",isActive:l}=e;return(0,a.jsx)("a",{className:"cursor-pointer ".concat(l?"active":""),children:(0,a.jsxs)("li",{className:"p-2 pl-3",onClick:r,children:[(0,a.jsx)("i",{className:"fa-solid fa-".concat(s," mr-4 w-4")})," ",(0,a.jsx)("span",{className:"first-letter:font-bold",children:t})]})})}function u(e){let{setConversations:t,setConversation:s,setActiveComponent:r,features:l,currentRoute:o,setCurrentRoute:i,session:u,userInfo:m}=e,p=(0,n.useRouter)(),h=p.asPath;return(0,a.jsx)("div",{children:(0,a.jsxs)("ul",{className:"pl-3",children:["/conversations"==o,(0,a.jsx)(d,{iconName:"user-hair-mullet text-blue",isActive:"/settings"==h,itemText:"Settings",onClick:()=>{p.push("/settings","/settings",{shallow:!0}),s(null)}}),m.includeTaskFeature?(0,a.jsx)(d,{iconName:"fa-sharp fa-regular text-orange fa-list-check",isActive:"/tasks"==h,itemText:"Todos",onClick:()=>{p.push("/tasks","/tasks",{shallow:!0}),s(null)}}):(0,a.jsx)(a.Fragment,{}),m.includeNotepad?(0,a.jsx)(d,{iconName:"fa-solid fa-memo-pad text-pink",isActive:"/notepad"==h,itemText:"Notepad",onClick:()=>{p.push("/notepad","/notepad",{shallow:!0}),s(null)}}):(0,a.jsx)(a.Fragment,{}),(0,a.jsx)(d,{iconName:"fa-solid fa-stars text-yellow",isActive:"/prompts"==h,itemText:"Prompts",onClick:()=>{p.push("/prompts","/prompts",{shallow:!0}),s(null)}}),(0,a.jsx)(d,{iconName:"fa-solid fa-stars text-yellow",isActive:"/savedResponses"==h,itemText:"Saved responses",onClick:()=>{p.push("/savedResponses","/savedResponses",{shallow:!0}),s(null)}}),(0,a.jsx)(d,{iconName:"fa-solid fa-toolbox text-purple",isActive:"/builder"==h,itemText:"Component builder",onClick:()=>{p.push("/builder","/builder",{shallow:!0}),s(null)}}),(0,a.jsx)(d,{iconName:"arrow-right-from-bracket text-red",itemText:"Log Out",onClick:()=>{(0,c.signOut)({callbackUrl:"/auth/signin"})}})]})})}function m(e){let{conversations:t,setConversation:s,conversation:r,conversationId:n,selectConversation:l,userInfo:o,setUserInfo:c,newConversation:d,setConversations:m,currentRoute:p,setCurrentRoute:h,setActiveComponent:x,isMobile:f,style:g,...v}=e;return(0,a.jsxs)("nav",{className:"h-full ".concat(f?"w-full absolute z-20":"w-[228px]"," shadow-md lg:block br-1-gray bg-dark transition-all duration-300"),style:g,children:[(0,a.jsx)(i,{conversations:t,setConversation:s,activeConversation:r,activeConversationId:n,selectConversation:l,userInfo:o,setUserInfo:c,newConversation:d,setConversations:m,currentRoute:p,c:v.c}),(0,a.jsx)("hr",{className:"my-4 border-t"}),(0,a.jsx)(u,{setConversations:m,setConversation:s,setActiveComponent:x,features:v.features,currentRoute:p,setCurrentRoute:h,session:v.session,userInfo:o}),(0,a.jsx)("i",{className:"fa-solid fa-arrow-left hidden-sm cursor-pointer text-gray w-5 h-5 mr-auto mb-3 ml-3 absolute bottom-0 left-0 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:e=>c({...o,hideSidebar:!0})})]})}function p(e){let{userInfo:t,setUserInfo:s}=e;return(0,a.jsx)("div",{className:"fixed top-0 left-0 z-50 flex items-center justify-start w-full p-2 pr-3 lg:hidden",children:(0,a.jsx)("button",{className:"text-red hover:text-red-500 cursor-default",children:(0,a.jsx)("i",{className:"fa-sharp fa-solid fa-bars fa-lg mt-3.5 ml-3 cursor-pointer",onClick:()=>{s({...t,hideSidebar:!t.hideSidebar})}})})})}let h=e=>{let{value:t,onChange:s,onKeyDown:n,placeholder:l,className:o,conversationId:i,textareaRef:c}=e,[d,u]=(0,r.useState)(45),m=e=>{s(e),""===e.target.value?u(45):(u("auto"),u(c.current.scrollHeight))};return(0,r.useEffect)(()=>{c.current&&""!==t&&u(c.current.scrollHeight)},[t]),(0,r.useEffect)(()=>{c.current&&c.current.focus()},[i]),(0,r.useEffect)(()=>{""===t&&45!==d&&u(45)},[t]),(0,a.jsx)("textarea",{ref:c,value:t,onChange:m,onKeyDown:n,placeholder:l,className:o,style:{height:d,minHeight:"45px",maxHeight:"120px",resize:"none",overflow:"auto"},onFocus:e=>{let{target:t,target:{value:{length:s}}}=e;t.setSelectionRange(s,s)}})};var x=s(2910);s(2182),console.log("creating ably from token...");var f=s(1268),g=s(8941);let v=e=>{let{users:t,selectedUserIndex:s,onSelect:r}=e,n=e=>{r&&r(e)};return(0,a.jsx)("div",{className:"mention-popover p-4 rounded text-offwhite",children:(0,a.jsx)("ul",{children:t.map((e,t)=>(0,a.jsxs)("li",{className:"rounded flex items-center cursor-pointer hover-blue p-1 ".concat(t===s?"bg-blue":""),onClick:()=>n(e.username),children:[(0,a.jsx)("img",{src:e.avatarSource||"/avatar.png",className:"rounded-full w-7 h-7 mr-2.5"}),e.username,(0,a.jsx)("span",{className:"relative w-4 h-4 mr-2.5 ml-2",children:(0,a.jsx)("span",{className:"absolute top-[1px] right-[1px] w-4 h-4 rounded-full unread-indicator bg-green"})})]},e.username))})})};var j=function(e){let{conversationId:t,conversation:s,setConversation:n,newMessage:o,sendMessage:i,updateMessageValue:c,starredMessages:d,setStarredMessages:u,referencedMessage:m,setReferencedMessage:p,userInfo:j}=e,b=(0,r.useRef)(null),w=(0,r.useRef)(null),[y,N]=(0,r.useState)(null),[k,S]=(0,r.useState)(!1),C=l.S.conversations.updateMessages.useMutation(),I=(0,r.useRef)(s.messages.length),[P,T]=(0,r.useState)([]);(0,r.useEffect)(()=>{g.L.users.query.query({id:!0,username:!0}).then(e=>{T(e)})},[]);let[E,A]=(0,r.useState)({top:0,left:0}),[M,R]=(0,r.useState)(!1),D=(0,r.useRef)(null),F=(0,r.useRef)(null),[L,U]=(0,r.useState)(0);f.Z.connection.bind("connected",async()=>{N(f.Z.connection.socket_id),z()}),f.Z.connection.bind("error",e=>{console.log("Pusher subscription failed:",e)});let z=async()=>{if(void 0===t)return;w.current&&w.current.unsubscribe();let e="private-conversation-".concat(t),a=await g.L.pusher.authenticate.query({socketId:f.Z.connection.socket_id,channelName:e});w.current=f.Z.subscribe(e,a),w.current.bind("new-conversation",function(e){n(e.conversation)}),w.current.bind("new-message",function(e){e.conversationId==s.id&&n({...s,messages:[...s.messages,e.message]})}),w.current.bind("client-is-typing",function(e){console.log("someone is typing!",e),k||(S(!0),console.log("newMessage",e),e.content?n({...s,messages:[...s.messages,e]}):n(s))})};async function K(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.messages[e].starred!=t.starred&&(t.starred?u([...d,t]):u(d.filter(e=>e.id!==t.id))),s.messages[e]=t;let r=a?s.messages.filter((t,s)=>s<=e):[...s.messages];console.log(r,r.length);let l={...s,messages:r};if(n(l),a){let e=C.mutate(l);console.log(e),n({...l=await g.L.openai.query.mutate(l),messages:l.messages})}}(0,r.useEffect)(()=>{z()},[t]);let q=null;return(0,r.useEffect)(()=>{I.current<s.messages.length&&(null==q||q.scrollIntoView({behaviour:"smooth"})),I.current=s.messages.length},[s]),(0,a.jsx)("div",{className:"mx-auto max-w-[760px] h-full relative",children:(0,a.jsxs)("div",{className:"mx-auto max-w-[760px]",children:[(0,a.jsxs)("div",{className:"p-1.5 pt-0 pb-0 mt-0 overflow-y-auto",id:"messages-box",ref:b,children:[s.messages.map((e,t)=>(0,a.jsx)(x.Z,{index:t,message:e,avatarSource:"/".concat(e.avatarSource),sender:"user"==e.role?e.sender||j:"ChatGPT-3.5",received:!0,updateState:K,setConversation:n,referencedMessage:m,onClick:()=>{p(e.id==(null==m?void 0:m.id)?null:e)},userInfo:j},s.id+t)),(0,a.jsx)("div",{ref:e=>{q=e}})]}),(0,a.jsxs)("form",{className:"flex items-end max-w-[760px] mb-3 pl-2 pr-2 sm:pl-0 sm:pr-0",id:"chat-form",children:[(0,a.jsx)(h,{value:o.content,onChange:c,onKeyDown:function(e){if(e.stopPropagation(),"Escape"==e.key){D.current.blur();return}"@"===e.key?(R(!0),F.current=e.target.selectionStart,U(0)):"ArrowUp"===e.key?M&&(U(e=>(e-1+P.length)%P.length),e.preventDefault()):"ArrowDown"===e.key?M&&(U(e=>(e+1)%P.length),e.preventDefault()):"Enter"===e.key&&M?P[L]&&(onSelect(P[L].username),R(!1)):"Shift"!==e.key&&"Meta"!==e.key&&R(!1),"Enter"!==e.key||e.shiftKey||M||(e.preventDefault(),i())},placeholder:"Type your message here...",className:"w-full p-2 mr-2 bg-dark",conversationId:t,textareaRef:D}),(0,a.jsx)("span",{className:"button-container",children:(0,a.jsx)("button",{type:"button",onClick:i,className:"font-semibold uppercase p-2",children:"Send"})})]}),M&&(0,a.jsx)(v,{users:P,selectedUserIndex:L,onSelect:e=>{let t=o.content.slice(0,F.current),s=o.content.slice(F.current);c(t+e+s),R(!1)}})]})})},b=function(e){let{starredMessages:t,setStarredMessages:s,role:n,setReferencedMessage:l,setConversationId:o,userInfo:i}=e,c=(0,r.useRef)(null),d=t.filter(e=>e.role==n),[u,m]=(0,r.useState)(!0),p=()=>{m(!1)};return(0,a.jsxs)("div",{children:[u&&(0,a.jsxs)("div",{className:"pl-7 pr-7 pt-5 pb-5 w-full flash flex justify-between zzz",children:[(0,a.jsx)("div",{"aria-atomic":"true",role:"alert",children:"Your details have been saved."}),(0,a.jsx)("button",{autoFocus:!0,className:"focus:outline-none",type:"button","aria-label":"Dismiss this message",onClick:p,children:(0,a.jsx)("i",{className:"fa-solid fa-xmark text-blue"})})]}),(0,a.jsxs)("div",{className:"container mx-auto max-w-[760px] mt-3 md:mt-5",id:"saved",children:[(0,a.jsx)("h1",{className:"hidden text-title font-medium uppercase mb-5 text-white tracking-wide md:block",children:"Saved"}),d.length>0&&(0,a.jsx)("div",{className:"overflow-y-auto",id:"messages-box",ref:c,children:d.map((e,r)=>(0,a.jsx)(x.Z,{onClick:()=>{l(e),o(e.conversationId)},index:r,message:e,avatarSource:"user"==e.role?e.avatarSource:"avatar-chat.png",sender:"user"==e.role?e.sender:"ChatGPT-3.5",received:!0,updateState:(e,a)=>{s(t.filter(e=>e.id!==a.id))},userInfo:i},e.id))})]})]})},w=function(e){let{passedFeatures:t=[]}=e,[s,n]=(0,r.useState)(t),[l,o]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),d=async e=>{e.preventDefault();try{let e=await fetch("/api/features",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,description:i})});if(!e.ok)throw Error("Failed to add feature.");n([...s,{name:l,description:i,starred:!1}]),o(""),c("")}catch(e){console.error(e)}},u=async e=>{try{let t=await fetch("/api/features/".concat(e.id),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete feature.");n(s.filter(t=>t.id!==e.id))}catch(e){console.error(e)}},m=async e=>{try{let t=[...s],a=t[e];a.starred=!a.starred,n(t);let r=await fetch("/api/features/".concat(a.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t[e])});if(!r.ok)throw Error("Failed to update feature.")}catch(e){console.error(e)}};return(0,a.jsxs)("div",{className:"container mx-auto mt-8",children:[(0,a.jsx)("div",{className:"w-full mb-8 overflow-hidden-lg shadow-lg",children:(0,a.jsx)("div",{className:"w-full overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-md font-semibold tracking-wide text-left uppercase border-b border-gray",children:[(0,a.jsx)("th",{className:"px-4 py-3",children:"Feature Name"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-3",children:"Starred"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray",children:s.map((e,t)=>(0,a.jsxs)("tr",{className:"border-gray",children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-no-wrap",children:e.name}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-pre-wrap",children:e.description}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-no-wrap",children:(0,a.jsx)("i",{className:"fa-stars text-yellow cursor-pointer ".concat(e.starred?"fa-solid":"fa-thin"),onClick:()=>m(t)})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-no-wrap",children:(0,a.jsx)("i",{className:"fas fa-edit cursor-pointer",onClick:()=>handleEdit(t)})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-no-wrap",children:(0,a.jsx)("i",{className:"fas fa-trash cursor-pointer",onClick:()=>u(e)})})]},t))})]})})}),(0,a.jsxs)("form",{onSubmit:d,className:"mx-auto max-w-[400px] flex-1 mt-6 md:mt-2",children:[(0,a.jsx)("h1",{className:"font-display text-title font-medium tracking-wide uppercase mt-50 mb-30",children:"Add Feature"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"name",className:"block font-bold mb-2 text-xs font-semibold uppercase italic text-white",children:"Feature Name"}),(0,a.jsx)("input",{type:"text",id:"featureName",value:l,onChange:e=>o(e.target.value),className:"shadow appearance-none border w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"description",className:"block font-bold mb-2 text-xs font-semibold uppercase italic text-white",children:"Description"}),(0,a.jsx)("textarea",{id:"description",value:i,onChange:e=>c(e.target.value),className:"shadow appearance-none border w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline"})]}),(0,a.jsx)("button",{type:"submit",className:" w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 focus:outline-none focus:shadow-outline",children:"Add Feature"})]})]})};s(6606);var y=s(4926),N=s(2490),k=s(5146);s(6485);var S=function(e){let{index:t,task:s,userInfo:n,setUserInfo:l,setActiveTask:o,setActiveTaskIndex:i}=e;s.id==n.activeTaskId&&i(t);let c=new Date().toLocaleString("en-US",{timeZone:"America/New_York",hour:"numeric",minute:"2-digit",hour12:!0});return(0,a.jsx)("div",{className:"w-full box cursor-pointer",onClick:()=>{o(s,t)},children:(0,a.jsxs)("div",{className:"message p-2 relative hover-dark-gray ".concat(s.id==n.activeTaskId?"bg-dark-blue":""),children:[(0,a.jsx)("img",{src:"avatar.png",alt:"Avatar",className:"w-6 h-6 rounded-full absolute left-4 top-0"}),(0,a.jsxs)("div",{className:"flex items-center pl-16",children:[(0,a.jsx)("br",{}),(0,a.jsxs)("p",{className:"text-xs inline-block absolute top-0 right-4 timestamp",children:[(0,a.jsxs)("span",{className:"message-direction",children:["",(0,a.jsx)("i",{className:"fa-regular fa-arrow-down-left fa-lg ml-1 mr-3 mt-2"})]})," ",c,(0,a.jsx)("i",{className:"fa-star ".concat("fa-regular"," ml-2 cursor-pointer"),onClick:()=>{}}),(0,a.jsx)("i",{className:"fa-solid  w-5 h-5 ml-2"})]}),(0,a.jsx)(y.D,{remarkPlugins:[N.Z],rehypePlugins:[k.Z],children:s.content,components:{p:e=>{let{children:t}=e;return(0,a.jsx)(a.Fragment,{children:t.map(e=>{if("string"==typeof e){let t=e.split("\n");return t.map((e,t)=>(0,a.jsxs)(r.Fragment,{children:[t>0&&(0,a.jsx)("br",{}),e]},t))}return e})})}}})]})]})})},C=s(4562);class I{constructor(e){this.value=e,this.next=null,this.prev=null}}class P{add(e){let t=new I(e);null===this.head?(this.head=t,this.tail=t):(this.tail.next=t,t.prev=this.tail,this.tail=t),e.id&&(this.indexMap[e.id]=t)}remove(e){null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev)}fromArray(e){console.log("here",e),e.forEach(e=>this.add(e)),console.log(this)}toArray(){let e=[],t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}mapArray(e){let t=this.toArray();return t.map(e)}map(e){let t=this.mapArray(e);return console.log("mapped",t),console.log("new LinkedList(mapped)",new P(t)),new P(t)}swap(e,t){if(e===t)return;let s=[];console.log(e.prev.value,e.prev.value.prevTaskId,e.value.prevTaskId,t.value.prevTaskId,t.next.value.prevTaskId);let a=e.prev,r=e.next,n=t.prev,l=t.next;return a===t?(t.prev=e,t.value.prevTaskId=e.value.id,s.push(t.value),e.next=t,e.prev=n,e.value.prevTaskId=(null==n?void 0:n.value.id)||null,s.push(e.value),t.next=r,null!==n&&(n.next=e),null!==r&&(r.prev=t,r.value.prevTaskId=t.value.id,s.push(r.value))):r===t&&(e.prev=t,e.value.prevTaskId=t.value.id,s.push(e.value),e.next=l,t.prev=a,t.value.prevTaskId=a.value.id,s.push(t.value),t.next=e,null!==a&&(a.next=t),null!==l&&(l.prev=e,l.value.prevTaskId=e.value.id,s.push(l.value))),this.head===e?this.head=t:this.head===t&&(this.head=e),this.tail===e?this.tail=t:this.tail===t&&(this.tail=e),s}toString(){return this.toArray().reduce((e,t)=>(console.log(e,t.content),e+t.content+" -> "),"")+"null"}*[Symbol.iterator](){let e=this.head;for(;null!==e;)yield e,e=e.next}constructor(e=[]){this.head=null,this.tail=null,this.indexMap={},e&&this.fromArray(e)}}function T(e){let{addingTask:t,setAddingTask:s,userInfo:n,activeProject:o,tasks:i,setTasks:c,placeholder:d=""}=e,u=(0,r.useRef)(null),[m,p]=(0,r.useState)({content:""}),[h,x]=(0,r.useState)(!1),f=l.S.tasks.create.useMutation(),g=new C.TodoistApi(n.todoistApiKey);return(0,a.jsx)("div",{style:{aspectRatio:"1 / 1"},children:(0,a.jsx)("div",{className:"bg-dark-blue h-full border border-gray cursor-pointer hover:bg-gray-900 rounded",onClick:()=>s(!0),children:(0,a.jsx)("div",{className:"flex h-full flex-col justify-center gap-4",children:t?(0,a.jsx)("textarea",{value:m.content,placeholder:d,onChange:e=>(e.stopPropagation(),p({...m,content:e.target.value})),onKeyDown:e=>{e.stopPropagation(),"Escape"===e.key&&s(!1),"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h||(x(!0),g.addTask({content:m.content,project_id:o.id}).then(async e=>{c(new P([...i.toArray(),e])),p({content:""}),s(!1),x(!1);let t=await f.mutateAsync({projectId:o.id,content:e.content,id:e.id,project:o,prevTaskId:i.tail.value.id});console.log(t)}).catch(e=>{console.log(e),x(!1)})))},className:"w-full h-full p-2 mr-2 bg-dark text-sm p-0 m-0 focus:ring-transparent !bg-inherit",style:{resize:"none",overflow:"auto"},textarearef:u,autoFocus:!0,onFocus:e=>{let{target:t,target:{value:{length:s}}}=e;t.setSelectionRange(s,s)}}):(0,a.jsx)("i",{className:"fas fa-plus text-4xl mx-auto"})})})},"new-task")}var E=function(e){let{index:t,project:s,setActiveProject:n,userInfo:o,setUserInfo:i}=e,c=l.S.users.setActiveProject.useMutation(),[d,u]=(0,r.useState)(o.hideProjectHeader&&s.id==o.activeProjectId);return(0,r.useEffect)(()=>{s.id!=o.activeProjectId&&(u(o.hideProjectHeader),o.update({hideProjectHeader:o.hideProjectHeader}))},[o.hideProjectHeader]),(0,a.jsxs)("div",{className:"w-full box cursor-pointer ".concat(""),children:[o.hideProjectHeader,(0,a.jsxs)("div",{className:"message relative bg-black hover-dark-blue ".concat(s.id==o.activeProjectId?"bg-gray-600":""," ").concat(d?"transform transition-all duration-300 max-h-0 overflow-y-hidden border-0":"p-4 pt-4 max-h-100"),onClick:()=>{n(s)},children:[(0,a.jsx)("img",{src:"avatar.png",alt:"Avatar",className:"w-9 h-9 rounded-full absolute left-4 top-2"}),(0,a.jsxs)("div",{className:"pl-16 pt-0",children:[(0,a.jsx)("span",{className:"text-sm mb-1 inline-block name",children:"Project"})," ",(0,a.jsx)("i",{className:"fa-regular fa-arrow-up fa-sm ml-1 mr-3 mt-2 cursor-pointer text-gray ml-auto transform transition duration-300 hover:scale-125 hover:font-bold",onClick:()=>{i({...o,hideProjectHeader:!d})}}),(0,a.jsx)("br",{}),(0,a.jsxs)("p",{className:"text-xs inline-block absolute top-3 right-4 timestamp",children:[(0,a.jsxs)("span",{className:"message-direction",children:["Pending",(0,a.jsx)("i",{className:"fa-regular fa-arrow-down-left fa-lg ml-1 mr-3 mt-2"})]})," ",(0,a.jsx)("i",{className:"fa-light ".concat(o.activeProjectId==s.id?"fa-toggle-on":"fa-toggle-off"," hover:font-bold fa-lg text-gray cursor-pointer"),onClick:async e=>{e.stopPropagation();let t=s.id==o.activeProjectId?null:s.id;await c.mutate(t),i({...o,activeProjectId:t}),n(null)}})]}),s.name]})]})]})};s(7226);var A=s(381),M=s.n(A);s(7319);var R=function(e){let{userInfo:t,setUserInfo:s,tasks:o,setTasks:i,activeProject:c,setActiveProject:d,projects:u,setProjects:m,c:p,settings:h}=e,x=new C.TodoistApi(t.todoistApiKey),f=(0,r.useRef)(null);(0,r.useRef)(null);let v=(0,r.useRef)(null),[j,b]=(0,r.useState)(null),[w,y]=(0,r.useState)(),[N,k]=(0,r.useState)(),[I,A]=(0,r.useState)(!1),[R,D]=(0,r.useState)({}),[F,L]=(0,r.useState)(),[U,z]=(0,r.useState)(!1),[K,q]=(0,r.useState)(null),G=l.S.users.setActiveTask.useMutation(),Z=l.S.users.setActiveProject.useMutation(),H=l.S.tasks.delete.useMutation();l.S.tasks.update.useMutation();let O=l.S.tasks.updateSwapped.useMutation();l.S.projects.update.useMutation();let _=(0,n.useRouter)(),B=e=>{let t=M().duration(e,"seconds");return M().utc(t.asMilliseconds()).format("HH:mm:ss")};(0,r.useEffect)(()=>{},[t.hideProjectHeader]),(0,r.useEffect)(()=>{if(p&&"/tasks"==_.asPath)switch(p.key){case"ArrowUp":N>0&&y(o[N-1],N-1);break;case"ArrowDown":N<o.length-1&&y(o[N+1],N+1);break;case"ArrowLeft":if(p.e.shiftKey){let e=o.indexMap[t.activeTaskId],s=e.prev;if(!s)return;let a=o.swap(e,s);console.log("saveableValues",a),O.mutate(a),i(new P(o.toArray()))}break;case"ArrowRight":if(p.e.shiftKey){let e=o.indexMap[t.activeTaskId],s=e.next;if(!s)return;let a=o.swap(s,e);O.mutate(a),i(new P(o.toArray()))}break;case"N":A(!0);break;case"Enter":J(o.find(e=>{let{id:s}=e;return s==t.activeTaskId}))}},[p]);let V=async()=>{let e=await g.L.tasks.query.query({projectId:c.id});console.log("tasks",e);let t=null;e.map(e=>{console.log("prevTaskId",t),g.L.tasks.update.mutate({id:e.id,prevTaskId:t}),console.log("prevTaskId",t=e.id)})};window&&(window.resetOrdering=V),(0,r.useEffect)(()=>{c&&(t.activeProjectId!=c.id&&(s({...t,activeProjectId:c.id}),Z.mutate(c.id)),x.getTasks({projectId:c.id,priority:1}).then(async e=>{let t=await g.L.tasks.queryRawSorted.query({projectId:c.id});console.log("sorted",t);let s=t.map(e=>(indexed[e.id]={...indexed[e.id],...e},{...indexed[e.id]}));i(new P(s)),q(s[0]),D(indexed)}).catch(e=>console.log(e)))},[null==c?void 0:c.id]);let W=async(e,a)=>{let r=e.id==t.activeTaskId?null:e.id;s({...t,activeTaskId:r,activeTaskSetAt:new Date}),k(a),y(e),await G.mutateAsync(r)},J=(e,t)=>(t&&t.stopPropagation(),e&&x.updateTask(e.id,{labels:e.labels.includes("completed")?e.labels.filter(e=>"completed"!=e):[...e.labels,"completed"].filter(e=>"in-progress"!=e)}).then(t=>{i(o.map(s=>s.id!=e.id?s:t))}).catch(e=>console.log(e))),Y=(e,t)=>(t&&t.stopPropagation(),e&&x.updateTask(e.id,{labels:e.labels.includes("in-progress")?e.labels.filter(e=>"in-progress"!=e):[...e.labels,"in-progress"].filter(e=>"completed"!=e)}).then(t=>{i(o.map(s=>s.id!=e.id?s:t))}).catch(e=>console.log(e)));return(0,a.jsx)("div",{className:"mx-auto h-full p-4 pt-0",children:(0,a.jsxs)("div",{className:"overflow-y-auto",ref:f,children:[u.filter(e=>!c||e.id==c.id).map((e,r)=>(0,a.jsx)(E,{index:r,project:e,setActiveProject:d,userInfo:t,setUserInfo:s},e.id+r)),"grid"==h.taskLayout?(0,a.jsxs)("div",{className:"grid ".concat(t.hideSidebar?"lg:grid-cols-6 sm:grid-cols-4 xs:grid-cols-3 !text-sm":"grid-cols-4"," gap-4 pt-4"),children:[o.mapArray((e,s)=>{let r=(null==F?void 0:F.id)!=e.id,n=e.id==t.activeTaskId;return(0,a.jsx)("div",{className:"relative aspect-w-1 aspect-h-1",style:{aspectRatio:"1 / 1"},children:(0,a.jsx)("div",{className:"group bg-dark-blue border h-full border-gray-700 cursor-pointer hover:bg-gray-600      \n                  ".concat(e.id==t.activeTaskId?"!bg-blue-950":"","\n                  ").concat(e.labels.includes("completed")?"!bg-green-950":"","\n                  ").concat(e.labels.includes("in-progress")?"!bg-orange-800":"","\n                  "),onClick:()=>W(e,s),children:(0,a.jsxs)("div",{className:"group flex h-full flex-col justify-center gap-4 ".concat((null==F?void 0:F.id)==e.id?"":"p-2"),children:[(null==F?void 0:F.id)!=e.id?(0,a.jsx)("span",{children:e.content}):(0,a.jsx)("textarea",{value:F.content,placeholder:F.content,onChange:e=>(e.stopPropagation(),L({...F,content:e.target.value})),onKeyDown:t=>{t.stopPropagation(),"Escape"===t.key&&L(null),"Enter"!==t.key||t.shiftKey||(t.preventDefault(),U||x.updateTask(e.id,{content:F.content}).then(t=>{i(o.map(t=>t.id!=e.id?t:F)),g.L.tasks.updateWhere.mutate({where:{id:F.id},data:{name:F.content}}),L(null),z(!1)}).catch(e=>console.log(e)))},className:"w-full h-full p-2 mr-2 bg-dark text-sm p-0 m-0 focus:ring-transparent !bg-inherit",style:{resize:"none",overflow:"auto"},conversationId:void 0,textareaRef:v,autoFocus:!0,onFocus:e=>{let{target:t,target:{value:{length:s}}}=e;t.setSelectionRange(s,s)}}),(0,a.jsxs)("div",{className:"w-full flex items-center justify-between absolute top-3 left-0 ".concat(!r&&"hidden"," ").concat(n?"":"invisible group-hover:visible"),children:[(0,a.jsx)("i",{className:"fa-solid fa-clock cursor-pointer text-gray w-5 h-5 mr-auto ml-3 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:t=>{t.stopPropagation(),e._editingTimeEstimate=!e._editingTimeEstimate}}),(0,a.jsx)("span",{className:"text-gray text-xs absolute text-center top-1 left-1/2 transform -translate-x-1/2",children:e._editingTimeEstimate?(0,a.jsx)("input",{type:"string",autofocus:!0,onFocus:()=>{this.setSelectionRange(this.value.length,this.value.length)},className:"w-auto cursor-default text-xs text-center border-1 !important text-sm p-0 m-0 focus:ring-transparent !bg-inherit",value:B(e.timeEstimate),onChange:t=>{t.stopPropagation(),e.timeEstimate=1},onKeyDown:t=>{t.stopPropagation(),"Enter"===t.key&&(t.preventDefault(),i(o.map(s=>s.id!=e.id?s:{...s,timeEstimate:t.target.value})))},onClick:e=>{e.stopPropagation()}}):e.timeEstimate?B(e.timeEstimate):""}),(0,a.jsx)("span",{className:"items-center text-gray w-5 h-5",children:(0,a.jsx)("i",{className:"fa-solid fa-arrow-right cursor-pointer text-gray w-5 h-5 absolute transform transition duration-300 hover:scale-125 hover:font-bold",onClick:t=>{t.stopPropagation(),g.L.tasks.postpone.mutate({taskId:e.id,projectName:c.name})}})}),(0,a.jsx)("i",{className:"fa-solid fa-edit cursor-pointer text-gray w-5 h-5 ml-auto mr-3 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:t=>{t.stopPropagation(),(null==F?void 0:F.id)!=e.id?L(e):L(null)}})]}),(0,a.jsxs)("div",{className:"w-full flex items-center justify-between absolute bottom-1 left-0 ".concat(!r&&"hidden"," ").concat(n?"":"invisible group-hover:visible"),children:[(0,a.jsx)("i",{className:"fa-solid fa-close cursor-pointer text-gray w-5 h-5 mr-auto ml-3 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:t=>(t.stopPropagation(),x.closeTask(e.id).then(t=>{i(new P(o.toArray().filter(t=>t.id!=e.id))),H.mutate(e.id)}).catch(e=>console.log(e)))}),(0,a.jsx)("span",{className:"items-center text-gray w-5 h-5",children:(0,a.jsx)("i",{className:"fa-solid fa-circle-half-stroke cursor-pointer text-gray w-5 h-5 absolute transform transition duration-300 hover:scale-125 hover:font-bold",onClick:t=>Y(e,t)})}),(0,a.jsx)("i",{className:"fa-solid ".concat(e.labels.includes("completed")?"fa-undo":"fa-check"," cursor-pointer text-gray w-5 h-5 ml-auto mr-3 transform transition duration-300 hover:scale-125 hover:font-bold"),onClick:t=>J(e,t)})]})]})})},e.id)}),(0,a.jsx)(T,{addingTask:I,setAddingTask:A,userInfo:t,activeProject:c,tasks:o,setTasks:i})]}):o.mapArray((e,r)=>(0,a.jsx)(S,{index:r,task:e,userInfo:t,setUserInfo:s,setActiveTask:W,setActiveTaskIndex:k},e.id+r))]})})};s(8514);var D=s(5152),F=s.n(D),L=s(7441),U=s(3709);let z=F()(async()=>{let{default:e}=await Promise.all([s.e(937),s.e(167)]).then(s.t.bind(s,1167,23));return t=>{let{forwardedRef:s,...r}=t;return(0,a.jsx)(e,{ref:s,...r})}},{loadableGenerated:{webpack:()=>[1167]},ssr:!1});function K(e){let{content:t,setContent:s,userInfo:n,setUserInfo:o,setDebuggerObject:i,setActiveTask:c}=e;console.log("notepad");let[d,u]=(0,r.useState)(t),[m,p]=(0,r.useState)({content:""}),[h,x]=(0,r.useState)(""),[f,v]=(0,r.useState)(!1),[j,b]=(0,r.useState)("Running query to GPT..."),[w,y]=(0,r.useState)(""),N=(0,r.useRef)(null),k=l.S.users.saveNote.useMutation(),S=(0,r.useRef)(null),I=new C.TodoistApi(n.todoistApiKey);(0,r.useEffect)(()=>{if(null==S?void 0:S.current){var e;(null===(e=S.current)||void 0===e?void 0:e.focus)&&S.current.focus()}},[]),m.id||g.L.users.getNote.query().then(e=>{e&&p(e),U.Z.inject({note:e})});let P=()=>{k.mutate(m),console.log("Saved note")};async function T(e){v(!0),console.log("runQuery",e);let t=await g.L.openai.queryPromptedPrompt.query([{role:"system",content:"You are a data retriever. For any prompt you should only return data. Do not respond as if you were an entity, just return the data you found when processing the query."},{role:"user",content:e}]);return console.log("response",t),t}return(0,r.useEffect)(()=>{u(m.content)},[m]),(0,r.useEffect)(()=>{clearTimeout(N.current),N.current=setTimeout(P,1e3)},[m]),(0,r.useEffect)(()=>{if(console.log(h,m.content),h.startsWith("{")&&h.endsWith("}")&&m.content.includes(h)&&!f){let e=h.replace(/\{(.+?)\}/g,"$1"),t=m.content.replace(e,j);m.content=t,p({...m,content:t}),T(e).then(e=>{let t=(0,L.TU)(e),s=m.content.replace("{".concat(j,"}"),t);p({...m,content:s}),x(""),v(!1)})}},[h,m]),(0,r.useEffect)(()=>{let e=e=>{var t;console.log("quill",e),e.getEditor().on("selection-change",s=>{s&&s.length>0?(console.log("Text is highlighted:",t=e.getEditor().getText(s.index,s.length)),y(t)):console.log("Text is not highlighted")}),console.log("root",e.getEditor().root),e.getEditor().root.addEventListener("keydown",e=>{if(console.log("binding quill"),"ArrowUp"==e.key)return console.log("highlightedText",t),console.log("selectedText",w),console.log("highlightedText",t),console.log("selectedText",w),console.log("highlightedText",t),console.log("selectedText",w),e.stopPropagation(),I.addTask({content:w||t,projectId:n.activeProjectId}).then(e=>{console.log("Added task",e),c(e),o({...n,activeTaskId:e.id})}).catch(e=>{console.log("Error adding task",e)}),!1})},t=()=>{if(S.current){e(S.current);return}setTimeout(t,200)};t()},[]),(0,a.jsxs)("div",{className:"w-full",children:[h,(0,a.jsx)(z,{theme:"snow",value:m.content,onChange:function(e){u(e),p({...m,content:e})},onKeyDown:function(e){if(e.stopPropagation(),"Escape"==e.key){S.current.blur();return}!["Shift","Meta","Tab"].includes(event.key)&&/[a-zA-Z0-9!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~ ]/.test(e.key)&&("{"==e.key?x("{"):""!=h&&("Backspace"==e.key?x(h.slice(0,-1)):x(h+e.key)))},forwardedRef:S})]})}var q=function(e){let{conversations:t,setConversations:s}=e,[n,o]=(0,r.useState)(-1),i=l.S.conversations.delete.useMutation(),c=e=>{o(e)},d=async e=>{try{let a=await i.mutate(e.id);console.log("delete response:",a),s(t.filter(t=>t.id!==e.id))}catch(e){console.error(e)}},u=(e,a)=>{let r=[...t];r[e]={...r[e],name:a},s(r)},m=(e,a)=>{let r=async()=>{let r=t[e].id;try{let n=await fetch("/api/conversations/".concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a})});if(!n.ok)throw Error("Failed to update conversation name.");let l=await n.json();console.log("updatedConversation:",l);let o=[...t];o[e]=l,s(o)}catch(e){console.error(e)}};r()},p=(e,t)=>{if("Enter"===t.key){o(-1);let s=t.target.value;m(e,s)}},h=async(e,a)=>{let r=[...t];r[e]={...r[e],isPublic:a.target.checked},s(r);let n=t[e].id;try{let t=await fetch("/api/conversations/".concat(n),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isPublic:r[e].isPublic})});if(!t.ok)throw Error("Failed to update conversation.")}catch(e){console.error(e)}};return(0,a.jsxs)("div",{className:"container mx-auto max-w-[760px] mt-3 md:mt-5",children:[(0,a.jsx)("h1",{class:"hidden text-title font-medium uppercase mb-5 text-white tracking-wide md:block",children:"Conversations"}),(0,a.jsx)("div",{className:"w-full mb-8 overflow-hidden-lg",id:"conversation-table",children:(0,a.jsx)("div",{className:"w-full overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm rounded",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-md font-semibold tracking-wide text-left uppercase border-b border-gra text-offwhite",children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"Name"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Edit"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Delete"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Public"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray",children:t.map((e,t)=>(0,a.jsxs)("tr",{className:"border-gray",children:[(0,a.jsx)("td",{className:"px-4 py-2 whitespace-no-wrap",children:n===t?(0,a.jsx)("input",{type:"text",style:{backgroundColor:"grey"},value:e.name,onChange:s=>u(t,s.target.value,e),onKeyDown:e=>p(t,e),className:"shadow appearance-none border w-full py-2 px-2 leading-tight focus:outline-none focus:shadow-outline"}):e.name}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-no-wrap",children:n!==t&&(0,a.jsx)("i",{className:"fas fa-edit cursor-pointer",onClick:()=>c(t)})}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-no-wrap",children:(0,a.jsx)("i",{className:"fas fa-trash cursor-pointer",onClick:()=>d(e)})}),(0,a.jsx)("td",{className:"px-4 py-2 whitespace-no-wrap",children:(0,a.jsx)("input",{type:"checkbox",checked:e.isPublic,onChange:e=>h(t,e)})})]},t))})]})})})]})},G=s(5675),Z=s.n(G);s(9669);let H=e=>{let{label:t,slug:s,checked:r,onChange:n}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-2 border-1",children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center form-field border-1",children:(0,a.jsx)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:s,children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-1",children:[(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide border-1",children:t}),(0,a.jsxs)("div",{className:"toggle-switch",children:[(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:()=>n(),className:"toggle-switch-checkbox",name:s,id:s}),(0,a.jsx)("label",{className:"toggle-switch-label",htmlFor:s,children:(0,a.jsx)("span",{className:"toggle-switch-inner"})})]})]})})})})};var O=function(e){let{userInfo:t,setUserInfo:s}=e;(0,r.useRef)(null);let[n,o]=(0,r.useState)(t),[i,c]=(0,r.useState)(t.avatarSource||"/avatar.png"),[d,u]=(0,r.useState)("unsaved"),m=(0,r.useRef)(),p=l.S.users.updateAvatar.useMutation(),h=e=>{o({...n,username:e.target.value})},x=e=>{o({...n,todoistApiKey:e.target.value})},f=e=>{o({...n,telegramUserId:e.target.value})},v=e=>{o({...n,gpt4ApiKey:e.target.value})},j=e=>{o({...n,defaultHomepage:e.target.value})},b=e=>{e.preventDefault(),u("saving"),g.L.users.update.mutate(n).then(e=>{u("saved"),s({...n})})},w=()=>{m.current.click()},y=async e=>{e.preventDefault();let t=e.target.files[0];if(!t){alert("Please select a file to upload.");return}let s=new FileReader;s.onloadend=()=>{c(s.result)},s.readAsDataURL(t);let a=new FormData;a.append("upload_preset","bssaeyfu"),a.append("file",t);try{let e=await fetch("https://api.cloudinary.com/v1_1/dnzmuwzf4/image/upload",{method:"POST",body:a});if(!e.ok)throw Error("HTTP error ".concat(e.status));let t=await e.json();console.log("Upload response:",t),await p.mutate(t.secure_url)}catch(e){console.error("Error uploading file:",e)}};return(0,a.jsxs)("div",{className:"mx-auto max-w-[760px] mt-3 md:mt-5",id:"my-account",children:[(0,a.jsx)("h1",{className:"hidden text-title font-medium uppercase mb-5 text-white tracking-wide md:block",children:"Account Information"}),(0,a.jsxs)("div",{className:"flex w-full flex-row gap-x-6",children:[(0,a.jsxs)("div",{className:"relative h-[20px] w-[80px] cursor-pointer gap-10 border border-white/20 hover:border-white/40 lg:h-[104px] lg:w-[104px]",onClick:w,children:[(0,a.jsx)(Z(),{src:i,alt:"profile picture",layout:"fill",objectFit:"cover",className:"rounded"}),(0,a.jsx)("form",{children:(0,a.jsx)("input",{ref:m,onChange:y,className:"hidden",type:"file",accept:"image/*"})})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-lg uppercase leading-4 text-white tracking-wide",children:n.username}),(0,a.jsx)("span",{className:"text-2xs uppercase tracking-wide text-white/60"}),(0,a.jsx)("div",{className:"mt-auto",children:(0,a.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,a.jsx)("button",{className:"relative whitespace-nowrap px-6 py-2 text-xs font-semibold uppercase tracking-wide transition-colors duration-200 border rounded border-transparent text-white btn-gray bg-dark",onClick:w,children:"Change"}),(0,a.jsx)("button",{className:"relative whitespace-nowrap px-6 py-2 text-xs font-semibold uppercase tracking-wide transition-colors duration-200 border rounded border-red text-red btn-red bg-dark hover:text-black",children:"Remove"})]})})]}),(0,a.jsx)("input",{type:"hidden",name:"delete",value:"false"})]}),(0,a.jsx)("div",{className:"flex w-full flex-row gap-x-6 mt-10",children:(0,a.jsxs)("form",{className:"flex w-full max-w-measure flex-col",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsx)("div",{className:"text-sm text-white font-semibold capitalize tracking-wide flex w-full flex-col items-stretch justify-center",children:(0,a.jsxs)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"username",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5",children:"Username*"})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",value:n.username,onChange:h,onKeyDown:e=>e.stopPropagation(),className:"h-10 w-full border-1 rounded bg-dark-gray py-2 px-4 text-sm outline-none bg-dark text-white",name:"username",id:"username"})})]})})}),(0,a.jsx)("div",{className:"flex flex-col gap-2 border-1",children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center form-field border-1",children:(0,a.jsx)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"use-tasks",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-1 round",children:[(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide border-1",children:"Use tasks feature"}),(0,a.jsxs)("div",{className:"toggle-switch",children:[(0,a.jsx)("input",{type:"checkbox",checked:n.includeTaskFeature,onChange:()=>{o({...n,includeTaskFeature:!n.includeTaskFeature})},className:"toggle-switch-checkbox",name:"use-tasks",id:"use-tasks"}),(0,a.jsx)("label",{className:"toggle-switch-label",htmlFor:"use-tasks",children:(0,a.jsx)("span",{className:"toggle-switch-inner"})})]})]})})})}),(0,a.jsx)("div",{className:"".concat(n.includeTaskFeature?"":"hidden"," flex flex-col gap-2"),children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center",children:(0,a.jsxs)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"email",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide",children:"Todoist API key"})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",value:n.todoistApiKey,onChange:x,onKeyDown:e=>e.stopPropagation(),className:"h-10 w-full border-1 bg-dark-gray py-2 px-4 text-sm outline-none bg-dark text-white rounded",name:"todoist-api",id:"todoist-api"})})]})})}),(0,a.jsx)("div",{className:"flex flex-col gap-2 border-1",children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center form-field border-1",children:(0,a.jsx)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"use-tasks",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-1",children:[(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide border-1",children:"Enable ChatGM Telegram bot"}),(0,a.jsxs)("div",{className:"toggle-switch",children:[(0,a.jsx)("input",{type:"checkbox",checked:n.enableChatGMBot,onChange:()=>{o({...n,enableChatGMBot:!n.enableChatGMBot})},className:"toggle-switch-checkbox",name:"use-bot",id:"use-bot"}),(0,a.jsx)("label",{className:"toggle-switch-label",htmlFor:"use-bot",children:(0,a.jsx)("span",{className:"toggle-switch-inner"})})]})]})})})}),!n.telegramUserId&&(0,a.jsx)("div",{className:"".concat(n.enableChatGMBot?"":"hidden"," flex flex-col gap-2"),children:(0,a.jsx)("a",{href:"https://t.me/ChatGoodMorningBot",target:"_blank",className:"text-sm flex flex-col gap-2 border-1",children:"Get your Telegram User ID here"})}),(0,a.jsx)("div",{className:"".concat(n.enableChatGMBot?"":"hidden"," flex flex-col gap-2"),children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center",children:(0,a.jsxs)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"email",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide",children:"Telegram User ID"})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",value:n.telegramUserId,onChange:f,onKeyDown:e=>e.stopPropagation(),className:"h-10 w-full border-1 bg-dark-gray py-2 px-4 text-sm outline-none bg-dark text-white rounded",name:"todoist-api",id:"todoist-api"})})]})})}),(0,a.jsx)("div",{className:"flex flex-col gap-2 border-1",children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center form-field border-1",children:(0,a.jsx)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"use-gpt4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-1",children:[(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide border-1",children:"Use GPT4"}),(0,a.jsxs)("div",{className:"toggle-switch",children:[(0,a.jsx)("input",{type:"checkbox",checked:n.useGPT4,onChange:()=>{o({...n,useGPT4:!n.useGPT4})},className:"toggle-switch-checkbox",name:"use-gpt4",id:"use-gpt4"}),(0,a.jsx)("label",{className:"toggle-switch-label",htmlFor:"use-gpt4",children:(0,a.jsx)("span",{className:"toggle-switch-inner"})})]})]})})})}),(0,a.jsx)("div",{className:"".concat(n.useGPT4?"":"hidden"," flex flex-col gap-2"),children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center",children:(0,a.jsxs)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"email",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide",children:"GPT4 API key"})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",value:n.gpt4ApiKey,onChange:v,onKeyDown:e=>e.stopPropagation(),className:"h-10 w-full border-2 bg-dark-gray py-2 px-4 text-sm outline-none bg-dark text-white",name:"todoist-api",id:"todoist-api"})})]})})}),(0,a.jsx)("div",{className:"".concat(""," flex flex-col gap-2"),children:(0,a.jsx)("div",{className:"gap-2 mt-5 text-sm text-white font-semibold capitalize flex w-full flex-col items-stretch justify-center",children:(0,a.jsxs)("label",{className:"flex cursor-pointer flex-col gap-2",htmlFor:"email",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("p",{className:"flex items-center justify-start gap-2 px-0.5 tracking-wide",children:"Default homepage"})}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("input",{type:"text",value:n.defaultHomepage,onChange:j,onKeyDown:e=>e.stopPropagation(),className:"h-10 w-full border-2 bg-dark-gray py-2 px-4 text-sm outline-none bg-dark text-white",name:"todoist-api",id:"todoist-api"})})]})})}),(0,a.jsx)(H,{label:"Enable notepad",slug:"use-notepad",checked:n.includeNotepad,onChange:()=>{o({...n,includeNotepad:!n.includeNotepad})}}),(0,a.jsxs)("button",{onClick:b,className:"".concat("saved"==d?"saved":"saving"==d?"saving":""," relative mt-6 px-6 py-2 text-xs font-semibold uppercase tracking-wide transition-colors duration-200 bg-dark hover:text-black px-6 py-2 mb-8"),children:[" ","saved"==d?"Saved":"saving"==d?(0,a.jsx)("span",{className:"spinner"}):"Save changes"]})]})})]})};function _(e){var t;let{userInfo:s,notificationData:l,setIsBellDropdownOpen:o}=e,i=(0,n.useRouter)(),[c,d]=(0,r.useState)([]),u=e=>{d([...c,e])},m=null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.filter(e=>!c.includes(e.id)),p=null==m?void 0:m.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)),h=e=>{let t=new Date(e),s=new Date,a=Math.floor((s-t)/1e3),r=new Intl.RelativeTimeFormat("en",{numeric:"auto"});if(a<60)return r.format(-a,"second");let n=Math.floor(a/60);if(n<60)return r.format(-n,"minute");let l=Math.floor(n/60);return l<24?r.format(-l,"hour"):r.format(-Math.floor(l/24),"day")};return(0,a.jsx)("div",{className:"absolute right-0 mt-9 w-48 bg-dark border-gray-light rounded-md shadow-lg z-100 dropdown-container bell",children:(0,a.jsx)("ul",{className:"py-1 text-base leading-6 text-offwhite",children:null==p?void 0:p.map(e=>(0,a.jsxs)("li",{onClick:()=>{i.push("/conversations/[id]","/conversations/".concat(e.conversation.id)),o(!1)},"aria-label":"Notification",className:"flex justify-between items-center px-4 py-2 hover-dark cursor-pointer -mx-0 -mt-1 -mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full overflow-hidden mr-3",children:(0,a.jsx)("img",{src:e.sender.avatarSource||"/avatar.png",className:"rounded-full w-10 h-10"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("p",{className:"text-sm text-offwhite",children:[(0,a.jsx)("span",{children:e.sender.username})," added"," ",e.recipient.username," to a"," ",(0,a.jsx)("strong",{children:"conversation"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-0.5",children:(0,a.jsx)("span",{children:e.conversation.name})}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:h(e.createdAt)})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"button","aria-label":"Mark as read",className:"focus:outline-none",onClick:t=>{t.stopPropagation(),u(e.id)},children:(0,a.jsx)("i",{className:"fa-solid fa-xmark"})})})]},e.id))})})}let B=e=>{var t,s,o,i;let{conversation:c,userInfo:d,setUserInfo:u,addSystemMessage:m,settings:p,setSettings:h,activeProject:x,setActiveProject:f,projects:g,setProjects:v}=e,[j,b]=(0,r.useState)(!0),[w,y]=(0,r.useState)(!1),N=l.S.conversations.removeParticipant.useMutation(),[k,S]=(0,r.useState)(!1),[I,P]=(0,r.useState)(!1),T=l.S.notifications.get.useQuery({}),E=l.S.projects.create.useMutation();l.S.projects.update.useMutation();let A=(0,n.useRouter)(),M=new C.TodoistApi(d.todoistApiKey),R=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=0==t?new Date:new Date(Date.parse(x.name)),a=new Date(s.setDate(s.getDate()+t)).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),r={name:a},n=g.find(e=>e.name==r.name);n?f(n):M.addProject(r).then(async e=>{let t=await E.mutateAsync({id:e.id,...r});f(t),v([...g,t]),console.log(t)})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("header",{className:"flex items-center justify-between px-4 py-2 relative",id:"top-nav",children:["/tasks"==A.asPath?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"gap-3 flex flex-row items-center",children:[(0,a.jsx)("i",{className:"fa-light fa-minus hover:font-bold mr-2 cursor-pointer text-gray-slate transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),h({...p,tasksPerRow:Math.max(p.tasksPerRow-1,2)})}}),(0,a.jsx)("i",{className:"fa-light fa-plus hover:font-bold cursor-pointer text-gray-slate transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),h({...p,tasksPerRow:Math.min(p.tasksPerRow+1,8)})}}),(0,a.jsx)("div",{className:"hover:font-bold cursor-pointer transform transition duration-300 hover:scale-125 text-red",onClick:R,children:" "}),(0,a.jsx)("div",{className:"gap-5"}),(0,a.jsx)("i",{className:"fa-solid fa-pipe fa-xl text-gray-slate"}),(0,a.jsx)("div",{className:"gap-5"}),(0,a.jsx)("i",{className:"fa-light fa-grid hover:font-bold mr-2 cursor-pointer text-gray-slate transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),h({...p,taskLayout:"grid"})}}),(0,a.jsx)("i",{className:"fa-light fa-list-ul hover:font-bold mr-2 cursor-pointer text-gray-slate transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),h({...p,taskLayout:"list"})}}),(0,a.jsx)("i",{className:"fa-regular fa-arrow-down fa-sm ml-1 mr-3 mt-2 cursor-pointer text-gray ml-auto transform transition duration-300 hover:scale-125 hover:font-bold ".concat(d.hideProjectHeader?"":"hidden"),onClick:()=>{u({...d,hideProjectHeader:!d.hideProjectHeader})}})]}),(0,a.jsxs)("div",{className:"gap-3 flex flex-row items-center",children:[(0,a.jsx)("i",{className:"fa-light fa-chevron-left hover:font-bold cursor-pointer transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),R(e,-1)}}),(0,a.jsx)("div",{className:"uppercase tracking-wide",children:null==x?void 0:x.name}),(0,a.jsx)("i",{className:"fa-light fa-chevron-right hover:font-bold cursor-pointer transform transition duration-300 hover:scale-125 hover:font-bold",onClick:async e=>{e.stopPropagation(),R(e,1)}})]})]}):(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"\xa0"}),((null==c?void 0:null===(t=c.participants)||void 0===t?void 0:t.length)||0)>1&&(0,a.jsx)("div",{className:"flex items-center space-x-2 hidden-sm",children:(0,a.jsxs)("div",{className:"flex items-center cursor-pointer w-190",onClick:()=>b(!j),children:[(0,a.jsx)("i",{className:"fa-solid mr-2 w-3 ".concat(j?"fa-arrow-down":"fa-arrow-right"," ml-2")}),(0,a.jsx)("span",{children:"".concat(null===(s=c.participants)||void 0===s?void 0:s.length," members")})]})}),(0,a.jsxs)("nav",{className:"space-x-4 relative flex z-10",children:[(0,a.jsx)("div",{className:"relative inline-block",children:(0,a.jsxs)("button",{className:"focus:outline-none","aria-expanded":k,onClick:()=>{S(!k),P(!1)},children:[(0,a.jsx)("i",{className:"fa-regular fa-bell fa-xl mr-2 pt-4"}),(0,a.jsx)("span",{className:"absolute top-[1px] right-[1px] w-4 h-4 rounded-full bg-blue unread-indicator"})]})}),k&&(0,a.jsx)(_,{userInfo:d,notificationData:T,setIsBellDropdownOpen:S}),(0,a.jsx)("button",{className:"focus:outline-none","aria-expanded":I,onClick:()=>{P(!I),S(!1)},children:(0,a.jsx)("img",{src:d.avatarSource||"/avatar.png",className:"rounded-full w-7 h-7 mr-2.5"})}),I&&(0,a.jsx)("div",{className:"absolute right-0 mt-9 w-48 bg-dark border-gray-light rounded-md shadow-lg z-100 dropdown-container",children:(0,a.jsxs)("ul",{className:"py-1 text-base leading-6 text-offwhite",children:[(0,a.jsxs)("li",{className:"flex flex-col items-start px-4 py-2 hover-dark cursor-pointer text-sm -mx-0 -mt-1 -mb-1",onClick:()=>(A.push("/account"),P(!1)),children:[(0,a.jsxs)("div",{className:"flex items-center w-full",children:[(0,a.jsx)("div",{className:"w-11 h-11 rounded-full overflow-hidden",children:(0,a.jsx)("img",{src:d.avatarSource||"/avatar.png",className:"rounded-full"})}),(0,a.jsx)("div",{className:"ml-1",children:(0,a.jsx)("span",{className:"ml-3",children:null==d?void 0:d.username})})]}),(0,a.jsxs)("div",{className:"flex items-center w-full mt-2",children:[(0,a.jsx)("i",{className:"fa-regular fa-gear"}),(0,a.jsx)("span",{className:"ml-2",children:"Settings"})]})]}),(0,a.jsx)("hr",{className:"border-t border-gray w-full my-2"}),(0,a.jsxs)("li",{className:"flex items-center px-4 py-2 hover-dark cursor-pointer text-sm -mx-0 -mt-1 -mb-1",children:[(0,a.jsx)("i",{className:"fa-solid fa-wave-pulse"}),(0,a.jsx)("span",{className:"ml-2",children:"Example 1"})]}),(0,a.jsxs)("li",{className:"flex items-center px-4 py-2 hover-dark cursor-pointer text-sm -mx-0 -mt-1 -mb-1",children:[(0,a.jsx)("i",{className:"fa-solid fa-puzzle-piece"}),(0,a.jsx)("span",{className:"ml-2",children:"Example 2"})]})]})})]})]}),((null==c?void 0:null===(o=c.participants)||void 0===o?void 0:o.length)||0)>1&&j&&(0,a.jsx)("div",{className:"absolute mt-14 pl-3",id:"members",children:(0,a.jsx)("ul",{className:"pl-0 w-[190px]",children:null===(i=c.participants)||void 0===i?void 0:i.map(e=>(0,a.jsxs)("li",{className:"group cursor-pointer hover-dark rounded items-center space-x-2 p-2 flex",children:[e.avatarSource?(0,a.jsx)("img",{src:e.avatarSource,className:"rounded-full h-7 w-7 mr-1"}):(0,a.jsx)("div",{className:"h-7 w-7 rounded-full ".concat(e.id==c.creatorId?"bg-yellow":"bg-green-bright"," mr-1")}),(0,a.jsxs)("span",{className:"text-offwhite",children:[e.username," ",e.id==c.creatorId?"(creator)":""]}),e.id!=d.id&&(0,a.jsx)("div",{className:"pl-4 pt-1 group-hover:block hidden flex items-center float-right background-orange-300",children:(0,a.jsx)("i",{className:"fa-light fa-close float-right hover:font-bold",onClick:async()=>{await N.mutateAsync({conversationId:c.id,participantUsername:e.username}),console.log(await m("".concat(d.username," removed ").concat(e.username," from the conversation.")))}})})]},"".concat(c.id,"/").concat(e.id)))})})]})};function V(e){let{debuggerObject:t}=e;return(0,a.jsx)("div",{className:"mx-auto max-w-[760px] mt-3 md:mt-5",children:(0,a.jsx)("textarea",{className:"w-full text-black",rows:10,defaultValue:JSON.stringify(t,null,2)})})}function W(e){let{modalOpen:t,setModalOpen:s,children:n}=e,[l,o]=(0,r.useState)(0);return(0,a.jsx)("div",{className:"".concat(t?"opacity-100":"opacity-".concat(l)," fixed z-50 inset-0 overflow-y-auto"),style:{transition:"opacity 0.2s ease-in-out"},children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:function(e){e.target===e.currentTarget&&s(!1)},children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,a.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"}),(0,a.jsxs)("div",{className:"".concat(t?"opacity-100 translate-y-0":"opacity-0 -translate-y-4"," inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"),style:{transition:"all 0.2s ease-in-out"},onTransitionEnd:function(){t||o(0)},children:[(0,a.jsx)("button",{className:"absolute top-0 right-0 text-gray-500 hover:text-gray-800",onClick:()=>{s(!1)},children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",width:"24",height:"24",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x",children:[(0,a.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),n]})]})})}let J=e=>{var t;let{data:s,status:o}=(0,c.useSession)();null==s||s.user;let i=(0,n.useRouter)(),[d,u]=(0,r.useState)(""),h=i.asPath;l.S.useContext();let[x,f]=(0,r.useState)(null),[v,y]=(0,r.useState)(!1),[N,k]=(0,r.useState)("/"),[S,I]=(0,r.useState)([]),[E,A]=(0,r.useState)(e.starredMessages||[]),[M,D]=(0,r.useState)(),[F,L]=(0,r.useState)(""),[U,z]=(0,r.useState)(new P(e.tasks)),[G,Z]=(0,r.useState)(void 0),[H,_]=(0,r.useState)({role:"user",content:F,avatarSource:"avatar.png",senderId:(null==s?void 0:null===(t=s.user)||void 0===t?void 0:t.id)||0}),[J,Y]=(0,r.useState)(void 0),[Q,X]=(0,r.useState)({response:""}),[$,ee]=(0,r.useState)({...e.userInfo,update:e=>g.L.users.update.mutate(e)}),[et,es]=(0,r.useState)({name:"",messages:S,isActive:!1,ownerId:$.id,creatorId:$.id,isPublic:!1}),[ea,er]=(0,r.useState)(e.conversations||[]),[en,el]=(0,r.useState)(e.activeTask),[eo,ei]=(0,r.useState)({tasksPerRow:6,taskLayout:"grid"}),[ec,ed]=(0,r.useState)(),[eu,em]=(0,r.useState)(!1),ep=(0,r.useRef)(!0),eh=l.S.conversations.updateMessages.useMutation(),[ex,ef]=(0,r.useState)(!1),[eg,ev]=(0,r.useState)([]),ej=new C.TodoistApi($.todoistApiKey);(0,r.useEffect)(()=>{ej.getProjects().then(e=>{g.L.projects.query.query().then(t=>{let s=t.reduce((e,t)=>(e[t.id.toString()]=t,e),{}),a=e.map(e=>({...e,...s[e.id]}));ev(a)})}).catch(e=>console.log(e))},[]),(0,r.useEffect)(()=>{if("/conversations/[id]"===i.pathname){let t=e.conversations.find(e=>e.id==i.query.id);t&&t.id!=et.id&&es(t),D(Number(i.query.id))}eu&&ee({...$,hideSidebar:!0})},[h]),(0,r.useEffect)(()=>{if(e.userInfo.activeProjectId){let t=new C.TodoistApi(e.userInfo.todoistApiKey);t.getProject(e.userInfo.activeProjectId).then(e=>{g.L.projects.get.query({id:e.id}).then(t=>{let s={...e,...t},{...a}=s;console.log("merged",s),Z(a)})}),t.getTasks({projectId:e.userInfo.activeProjectId}).then(t=>{g.L.tasks.queryRawSorted.query({projectId:e.userInfo.activeProjectId}).then(e=>{let s=t.reduce((e,t)=>(e[t.id]=t,e),{}),a=e.map(e=>(s[e.id]={...s[e.id],...e},{...s[e.id]}));z(new P(a))})})}},[]),(0,r.useEffect)(()=>{if($.activeTaskId&&$.activeTaskId!=en.id){let e=new C.TodoistApi($.todoistApiKey);e.getTask($.activeTaskId).then(e=>{el(e)})}},[$]),(0,r.useEffect)(()=>{"/"!=h&&"/conversations/[id]"!=i.pathname&&D(void 0)},[h]),(0,r.useEffect)(()=>{M&&(M==et.id&&et.participants&&10!=et.messages.length||g.L.conversations.get.query({id:M}).then(e=>{if(!e)return i.push("/","/",{shallow:!0});es(e)}),"/"!=N&&k("/"))},[M]),(0,r.useEffect)(()=>{if(null!=et&&k("/"),!(null==et?void 0:et.id))return;let e=!1,t=ea.map(t=>t.id==et.id?(e=!0,et):t);e?er(t):er([et,...ea])},[et]),(0,r.useEffect)(()=>{var e;_({...H,senderId:(null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.id)||0})},[s]),(0,r.useEffect)(()=>{var t;switch(null===(t=e.c)||void 0===t?void 0:t.key){case"c":ew();break;case"n":i.push("/notepad");break;case"p":i.push("/prompts");break;case"r":i.push("/savedResponses");break;case"s":i.push("/settings");break;case"t":i.push("/tasks");break;case"N":"/tasks"!=h&&ef(!0)}},[e.c]),(0,r.useEffect)(()=>{eb.current&&function(e){if(!e){console.error("Container element is null");return}let t=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){let t=e.lastElementChild;t&&t.scrollIntoView({behavior:"smooth"})}})},{root:e,rootMargin:"0px",threshold:1}),s=e.lastElementChild;s&&t.observe(s)}(eb.current)},[]);let eb=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e,t;null===(e=eb.current)||void 0===e||null===(t=e.lastElementChild)||void 0===t||t.scrollIntoView({behavior:"smooth"})},[S]),(0,r.useEffect)(()=>{var t;(null===(t=e.userInfo)||void 0===t?void 0:t.defaultHomepage)&&"/"==h&&i.push("/"+e.userInfo.defaultHomepage)},[]),(0,r.useEffect)(()=>{ep.current?ep.current=!1:$.update({hideSidebar:$.hideSidebar})},[$.hideSidebar]),(0,r.useEffect)(()=>{let e=()=>{em(window.innerWidth<=640)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let ew=e=>{null==e||e.preventDefault(),es({messages:[],isActive:!0,ownerId:$.id,creatorId:$.id,isPublic:!1}),D(void 0),i.push("/")};(0,r.useRef)(null);let ey=e=>{L(e.target.value),_({...H,content:e.target.value})},eN=e=>{et.messages.push(e),es(e=>({...e}))},ek=async e=>{et.messages.push({role:"system",content:e,avatarSource:"avatar-chat-gray.png"}),es(e=>({...e}));let t=await eh.mutateAsync(et);return es(t),t},eS=()=>{_({role:"user",content:"",avatarSource:"avatar.png",senderId:(null==s?void 0:s.user.id)||0})},eC=(e,t)=>{es({...t,messages:[...t.messages,e]})},eI=async()=>{let e=H.content.split(" ")[0].substring(1);eS();let t=await g.L.conversations.addParticipant.mutate({conversationId:et.id||-1,participantUsername:e}),s=await g.L.users.find.query({username:e});return t=await ek("".concat($.username," added ").concat(H.content.split(" ")[0].substring(1)," to the conversation.")),await g.L.notifications.create.mutate({senderId:$.id,recipientId:null==s?void 0:s.id,conversationId:et.id,type:"addedToConversation"}),t},eP=async()=>{if(H.content.startsWith("@")&&et.id)return eI();eN(H),eS();var e=et;et.id?e=await g.L.messages.create.mutate({...H,conversationId:et.id}):(eC({role:"systen",content:"Generating name...",avatarSource:"avatar-chat-gray.png"},e=await g.L.conversations.create.mutate(et)),e=await g.L.openai.generateName.mutate(e)||e,es({...et,name:e.name||et.name})),eC({role:"assistant",content:'<i className="fa-duotone fa-2x fa-spinner fa-spin text-offwhite"></i>',avatarSource:"avatar-chat.png"},e),es({...e=await g.L.openai.query.mutate(e),messages:e.messages}),M||D(e.id)},eT=e=>{es(e),D(e.id),eu&&ee({...$,hideSidebar:!0})},[eE,eA]=(0,r.useState)();return console.log("home"),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex h-full",id:"main-container",children:[(0,a.jsx)(m,{conversations:ea,setConversations:er,conversation:et,conversationId:M,setConversation:es,setActiveComponent:eA,features:e.features,activeConversation:et,activeConversationId:M,selectConversation:eT,userInfo:$,setUserInfo:ee,newConversation:ew,currentRoute:N,setCurrentRoute:k,c:e.c,isMobile:eu,style:{transition:"z-20 opacity 0.3s ease-out, transform 0.3s ease-out",opacity:$.hideSidebar?.5:1,transform:$.hideSidebar?"translateX(-100%)":"translateX(0)"}}),$.hideSidebar&&(0,a.jsx)(p,{userInfo:$,setUserInfo:ee}),(0,a.jsxs)("div",{className:"flex flex-col h-full w-full transition-all duration-300 ".concat($.hideSidebar&&!eu?"ml-[-225px]":""),children:[(0,a.jsx)(B,{conversation:et,userInfo:$,setUserInfo:ee,addSystemMessage:ek,settings:eo,setSettings:ei,activeProject:G,setActiveProject:Z,projects:eg,setProjects:ev}),"/tasks"!=h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center ".concat(ex?"block":"hidden"),children:(0,a.jsx)("div",{className:"w-1/5",children:(0,a.jsx)(T,{addingTask:ex,setAddingTask:ef,userInfo:$,activeProject:G,tasks:U,setTasks:z,placeholder:"Add a task..."})})}),v&&(0,a.jsx)(W,{modalOpen:v,setModalOpen:y,children:(0,a.jsx)(a.Fragment,{})}),(0,a.jsxs)("main",{className:"".concat(!$.hideSidebar&&"container mx-auto"," flex-1 mt-0"),children:[et&&("/"==h||"/conversations/[id]"==i.pathname)?(0,a.jsx)(j,{conversationId:M,conversation:et,setConversation:es,sendMessage:eP,newMessage:H,updateMessageValue:ey,starredMessages:E,setStarredMessages:A,referencedMessage:J,setReferencedMessage:Y,userInfo:$}):null,"/features"==h?(0,a.jsx)(w,{passedFeatures:e.features}):null,"/tasks"==h?(0,a.jsx)(R,{userInfo:$,setUserInfo:ee,tasks:U,setTasks:z,activeProject:G,setActiveProject:Z,projects:eg,setProjects:ev,c:e.c,settings:eo}):null,"/notepad"==h?(0,a.jsx)(K,{content:x,setContent:f,userInfo:$,setUserInfo:ee,setDebuggerObject:ed,setActiveTask:el}):null,"/features"==h?(0,a.jsx)(w,{passedFeatures:e.features}):null,"/settings"==h?(0,a.jsx)(O,{userInfo:$,setUserInfo:ee}):null,"/conversations"==h?(0,a.jsx)(q,{conversations:ea,setConversations:er}):null,"/prompts"==h?(0,a.jsx)(b,{starredMessages:E,setStarredMessages:A,setReferencedMessage:Y,setConversationId:D,userInfo:$,role:"user"}):null,"/savedResponses"==h?(0,a.jsx)(b,{starredMessages:E,setStarredMessages:A,setReferencedMessage:Y,setConversationId:D,userInfo:$,role:"assistant"}):null,$.activeTaskId&&!1,ec&&(0,a.jsx)(V,{debuggerObject:ec}),$.hideSidebar&&!eu&&(0,a.jsx)("i",{className:"fa-solid hidden-sm fa-arrow-right cursor-pointer text-gray w-5 h-5 mr-auto mb-3 ml-3 absolute bottom-0 left-0 transform transition duration-300 hover:scale-125 hover:font-bold",onClick:e=>ee({...$,hideSidebar:!1})})]})]})]})})};var Y=J},1268:function(e,t,s){var a=s(6606),r=s.n(a);let n=new(r())("227d14e2b7408912423b",{cluster:"us2",authEndpoint:"/api/auth/pusher"});t.Z=n}}]);